<Window
    x:Class="Editor.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Editor"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:trace="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
    Title="{Binding MainWindowTitle, Mode=OneWay}"
    Width="928"
    Height="550"
    d:DataContext="{d:DesignInstance Type=local:MainWindowViewModel}"
    ui:TitleBar.Height="36"
    ui:WindowHelper.SystemBackdropType="Mica"
    ui:WindowHelper.UseModernWindowStyle="True"
    Closing="Window_Closing"
    KeyDown="Window_KeyDown"
    KeyUp="Window_KeyUp"
    Loaded="Window_Loaded"
    MouseDown="Window_MouseDown"
    StateChanged="Window_StateChanged"
    TextInput="Window_TextInput"
    mc:Ignorable="d">
    <Window.Resources>
        <Style x:Key="ToolbarButton" TargetType="Button">
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
        </Style>
        <Style x:Key="ToolbarToggleButton" TargetType="ToggleButton">
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
        </Style>
        <Style x:Key="ToolbarImage" TargetType="Image">
            <Setter Property="Width" Value="24" />
            <Setter Property="Height" Value="24" />
        </Style>
    </Window.Resources>
    <Window.InputBindings>
        <KeyBinding
            Key="N"
            Command="{Binding NewCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="O"
            Command="{Binding OpenCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="S"
            Command="{Binding SaveCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="S"
            Command="{Binding SaveAsCommand, Mode=OneTime}"
            Modifiers="Ctrl+Shift" />
        <KeyBinding
            Key="P"
            Command="{Binding PrintCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="W"
            Command="{Binding CloseCommand, Mode=OneTime}"
            Modifiers="Ctrl+Shift" />
        <KeyBinding
            Key="Z"
            Command="{Binding UndoCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="Y"
            Command="{Binding RedoCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="X"
            Command="{Binding CutCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="C"
            Command="{Binding CopyCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="V"
            Command="{Binding PasteCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="A"
            Command="{Binding SelectAllCommand, Mode=OneTime}"
            Modifiers="Ctrl" />
    </Window.InputBindings>

    <DockPanel x:Name="MainDock" LastChildFill="True">
        <Grid DockPanel.Dock="Top">
            <StackPanel
                HorizontalAlignment="Right"
                Panel.ZIndex="10"
                Orientation="Horizontal">
                <ui:AppBarButton
                    Width="44"
                    Height="48"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    ui:CornerRadius="0"
                    Command="{Binding ToggleFullScreenModeCommand, Mode=OneTime}"
                    ToolTip="{DynamicResource MainWindow_ExitFullScreen}"
                    Visibility="{Binding FullScreenButtonVisibility, Mode=OneWay}">
                    <ui:AppBarButton.Icon>
                        <ui:FontIcon
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Glyph="&#xE73F;" />
                    </ui:AppBarButton.Icon>
                </ui:AppBarButton>
                <ui:AppBarButton
                    Width="44"
                    Height="48"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    ui:CornerRadius="0"
                    Command="{Binding CloseCommand, Mode=OneTime}"
                    ToolTip="{DynamicResource Close}"
                    Visibility="{Binding FullScreenButtonVisibility, Mode=OneWay}">
                    <ui:AppBarButton.Icon>
                        <ui:FontIcon
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Glyph="&#xE711;" />
                    </ui:AppBarButton.Icon>
                </ui:AppBarButton>
            </StackPanel>

            <Menu>
                <MenuItem Header="{DynamicResource MainWindow_File}">
                    <MenuItem
                        Command="{Binding NewCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_New}"
                        InputGestureText="Ctrl+N" />
                    <MenuItem
                        Command="{Binding OpenCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Open}"
                        InputGestureText="Ctrl+O" />
                    <MenuItem x:Name="RecentFileItem" Header="{DynamicResource MainWindow_Recent}" />
                    <MenuItem
                        Command="{Binding SaveCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Save}"
                        InputGestureText="Ctrl+S" />
                    <MenuItem
                        Command="{Binding SaveAsCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_SaveAs}"
                        InputGestureText="Ctrl+Shift+S" />
                    <MenuItem Header="{DynamicResource MainWindow_Export}">
                        <MenuItem
                            Command="{Binding ExportCommand, Mode=OneTime}"
                            CommandParameter="png"
                            Header="{DynamicResource MainWindow_Export_PNG}" />
                        <MenuItem
                            Command="{Binding ExportCommand, Mode=OneTime}"
                            CommandParameter="jpg"
                            Header="{DynamicResource MainWindow_Export_JPG}" />
                        <MenuItem
                            Command="{Binding ExportCommand, Mode=OneTime}"
                            CommandParameter="gif"
                            Header="{DynamicResource MainWindow_Export_GIF}" />
                        <MenuItem
                            Command="{Binding ExportCommand, Mode=OneTime}"
                            CommandParameter="bmp"
                            Header="{DynamicResource MainWindow_Export_BMP}" />
                        <MenuItem
                            Command="{Binding ExportCommand, Mode=OneTime}"
                            CommandParameter="tif"
                            Header="{DynamicResource MainWindow_Export_TIFF}" />
                        <MenuItem
                            Command="{Binding ExportCommand, Mode=OneTime}"
                            CommandParameter="wdp"
                            Header="{DynamicResource MainWindow_Export_WMP}" />
                    </MenuItem>
                    <Separator />
                    <MenuItem
                        Command="{Binding PrintCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Print}"
                        InputGestureText="Ctrl+P" />
                    <Separator />
                    <MenuItem
                        Command="{Binding CloseCommand, Mode=OneTime}"
                        Header="{DynamicResource Close}"
                        InputGestureText="Ctrl+Shift+W" />
                    <MenuItem Command="{Binding ExitCommand, Mode=OneTime}" Header="{DynamicResource MainWindow_Exit}" />
                </MenuItem>

                <MenuItem Header="{DynamicResource MainWindow_Edit}">
                    <MenuItem
                        Command="{Binding UndoCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Undo}"
                        InputGestureText="Ctrl+Z"
                        IsEnabled="{Binding UndoManager.CanUndo, Mode=OneWay}" />
                    <MenuItem
                        Command="{Binding RedoCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Redo}"
                        InputGestureText="Ctrl+Y"
                        IsEnabled="{Binding UndoManager.CanRedo, Mode=OneWay}" />
                    <Separator />
                    <MenuItem
                        Command="{Binding CutCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Cut}"
                        InputGestureText="Ctrl+X"
                        IsEnabled="{Binding IsSelecting, Mode=OneWay}" />
                    <MenuItem
                        Command="{Binding CopyCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Copy}"
                        InputGestureText="Ctrl+C"
                        IsEnabled="{Binding IsSelecting, Mode=OneWay}" />
                    <MenuItem
                        Command="{Binding PasteCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Paste}"
                        InputGestureText="Ctrl+V"
                        IsEnabled="{Binding ClipboardHelper.CanPaste, Mode=OneWay}" />
                    <MenuItem
                        Command="{Binding DeleteCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_Delete}"
                        InputGestureText="Del"
                        IsEnabled="{Binding IsSelecting, Mode=OneWay}" />
                    <Separator />
                    <MenuItem
                        Command="{Binding SelectAllCommand, Mode=OneTime}"
                        Header="{DynamicResource MainWindow_SelectAll}"
                        InputGestureText="Ctrl+A" />
                </MenuItem>

                <MenuItem Header="{DynamicResource MainWindow_Insert}">
                    <MenuItem Command="{Binding OpenUnicodeSelectorWindowCommand, Mode=OneTime}" Header="{DynamicResource MainWindow_Symbol}" />
                    <MenuItem Command="{Binding OpenCodepointWindowCommand, Mode=OneTime}" Header="{DynamicResource MainWindow_UnicodeValue}" />
                </MenuItem>

                <MenuItem Header="{DynamicResource MainWindow_View}">
                    <MenuItem Command="{Binding ToggleFullScreenModeCommand, Mode=OneTime}" Header="{Binding FullScreenMenuItemHeader, Mode=OneWay}" />
                    <MenuItem Header="{DynamicResource MainWindow_Zoom}">
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="25%"
                            IsCheckable="True"
                            Tag="25" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="50%"
                            IsCheckable="True"
                            Tag="50" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="75%"
                            IsCheckable="True"
                            Tag="75" />
                        <MenuItem
                            x:Name="DefaultZoomPercentageItem"
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="100%"
                            IsCheckable="True"
                            Tag="100" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="150%"
                            IsCheckable="True"
                            Tag="150" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="200%"
                            IsCheckable="True"
                            Tag="200" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="250%"
                            IsCheckable="True"
                            Tag="250" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="300%"
                            IsCheckable="True"
                            Tag="300" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="400%"
                            IsCheckable="True"
                            Tag="400" />
                        <MenuItem
                            Command="{Binding ChangeZoomPercentageCommand, Mode=OneTime}"
                            CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                            Header="500%"
                            IsCheckable="True"
                            Tag="500" />
                        <MenuItem
                            Command="{Binding OpenCustomZoomWindowCommand, Mode=OneTime}"
                            Header="{Binding CustomZoomMenuHeader, Mode=OneWay}"
                            IsCheckable="True"
                            IsChecked="{Binding CustomZoomMenuChecked, Mode=OneWay}" />
                    </MenuItem>
                    <MenuItem Command="{Binding ToggleShowNestingCommand, Mode=OneTime}" Header="{Binding ShowNestingMenuItemHeader, Mode=OneWay}" />
                </MenuItem>

                <MenuItem Header="{DynamicResource MainWindow_Tools}">
                    <MenuItem Command="{Binding OpenSettingsWindowCommand, Mode=OneTime}" Header="{DynamicResource MainWindow_Settings}" />
                </MenuItem>

                <MenuItem Header="{DynamicResource MainWindow_Help}">
                    <MenuItem Command="{Binding OpenContentsCommand, Mode=OneTime}" Header="{DynamicResource MainWindow_Contents}" />
                    <Separator />
                    <MenuItem Command="{Binding OpenAboutWindowCommand, Mode=OneTime}" Header="{DynamicResource MainWindow_About}" />
                </MenuItem>
            </Menu>
        </Grid>

        <Grid
            Margin="0 2 0 4"
            HorizontalAlignment="Stretch"
            DockPanel.Dock="Top">
            <ToolBarTray IsLocked="True">
                <ToolBar Band="0" BandIndex="1">
                    <Button
                        Command="{Binding SaveCommand, Mode=OneTime}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_Save}"
                        ToolTipService.ShowOnDisabled="True">
                        <Image Source="/Images/GUI/save.png" Style="{StaticResource ToolbarImage}" />
                    </Button>
                    <Button
                        Command="{Binding SaveAsCommand, Mode=OneTime}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_SaveAs}"
                        ToolTipService.ShowOnDisabled="True">
                        <Image Source="/Images/GUI/saveas.png" Style="{StaticResource ToolbarImage}" />
                    </Button>
                    <Button
                        Command="{Binding OpenCommand, Mode=OneTime}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_Open}"
                        ToolTipService.ShowOnDisabled="True">
                        <Image Source="/Images/GUI/open.png" Style="{StaticResource ToolbarImage}" />
                    </Button>
                    <Separator />
                    <Button
                        Command="{Binding UndoCommand, Mode=OneTime}"
                        IsEnabled="{Binding UndoManager.CanUndo, Mode=OneWay}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_Undo}"
                        ToolTipService.ShowOnDisabled="True">
                        <local:AutoGreyableImage Style="{StaticResource ToolbarImage}" Uri="Images/GUI/undo.png" />
                    </Button>
                    <Button
                        Command="{Binding RedoCommand, Mode=OneTime}"
                        IsEnabled="{Binding UndoManager.CanRedo, Mode=OneWay}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_Redo}"
                        ToolTipService.ShowOnDisabled="True">
                        <local:AutoGreyableImage Style="{StaticResource ToolbarImage}" Uri="Images/GUI/redo.png" />
                    </Button>
                    <Separator />
                    <Button
                        Command="DecreaseZoom"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_ZoomOut}"
                        ToolTipService.ShowOnDisabled="True">
                        <local:AutoGreyableImage Style="{StaticResource ToolbarImage}" Uri="Images/GUI/zoomout.png" />
                    </Button>
                    <Button
                        Command="IncreaseZoom"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_ZoomIn}"
                        ToolTipService.ShowOnDisabled="True">
                        <local:AutoGreyableImage Style="{StaticResource ToolbarImage}" Uri="Images/GUI/zoomin.png" />
                    </Button>
                    <Separator />
                    <Button
                        Command="{Binding CutCommand, Mode=OneTime}"
                        IsEnabled="{Binding IsSelecting, Mode=OneWay}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_Cut}"
                        ToolTipService.ShowOnDisabled="True">
                        <local:AutoGreyableImage Style="{StaticResource ToolbarImage}" Uri="Images/GUI/cut.png" />
                    </Button>
                    <Button
                        Command="{Binding CopyCommand, Mode=OneTime}"
                        IsEnabled="{Binding IsSelecting, Mode=OneWay}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_Copy}"
                        ToolTipService.ShowOnDisabled="True">
                        <local:AutoGreyableImage Style="{StaticResource ToolbarImage}" Uri="Images/GUI/copy.png" />
                    </Button>
                    <Button
                        Command="{Binding PasteCommand, Mode=OneTime}"
                        Style="{StaticResource ToolbarButton}"
                        ToolTip="{DynamicResource MainWindow_Paste}"
                        ToolTipService.ShowOnDisabled="True">
                        <Image Source="/Images/GUI/paste.png" Style="{StaticResource ToolbarImage}" />
                    </Button>
                    <Separator />
                    <ComboBox
                        Width="90"
                        VerticalAlignment="Center"
                        DisplayMemberPath="Display"
                        ItemsSource="{Binding AllFontTypes, Mode=OneTime}"
                        SelectedValue="{Binding TextFontType, Mode=TwoWay}"
                        SelectedValuePath="Value"
                        Style="{StaticResource DefaultComboBoxStyle}" />
                    <Separator />
                    <ComboBox
                        Width="90"
                        VerticalAlignment="Center"
                        DisplayMemberPath="Display"
                        ItemsSource="{Binding AllEditModes, Mode=OneTime}"
                        SelectedValue="{Binding TextEditorMode, Mode=TwoWay}"
                        SelectedValuePath="Value"
                        Style="{StaticResource DefaultComboBoxStyle}" />
                    <ToggleButton
                        IsChecked="{Binding InputBold, Mode=TwoWay}"
                        Style="{StaticResource ToolbarToggleButton}"
                        ToolTip="{DynamicResource MainWindow_Bold}">
                        <Image Source="/Images/GUI/bold.png" Style="{StaticResource ToolbarImage}" />
                    </ToggleButton>
                    <!--<ToggleButton
                        IsChecked="{Binding InputItalic}"
                        IsEnabled="{Binding Path=EditorMode, Converter={StaticResource EditorModeToBoolConverter}}"
                        Style="{StaticResource ToolbarToggleButton}"
                        ToolTip="Italic" />-->
                    <ToggleButton
                        IsChecked="{Binding InputItalic, Mode=TwoWay}"
                        Style="{StaticResource ToolbarToggleButton}"
                        ToolTip="{DynamicResource MainWindow_Italic}">
                        <Image Source="/Images/GUI/italic.png" Style="{StaticResource ToolbarImage}" />
                    </ToggleButton>
                    <ToggleButton
                        IsChecked="{Binding InputUnderline, Mode=TwoWay}"
                        Style="{StaticResource ToolbarToggleButton}"
                        ToolTip="{DynamicResource MainWindow_Underline}">
                        <Image Source="/Images/GUI/underline.png" Style="{StaticResource ToolbarImage}" />
                    </ToggleButton>
                    <Separator />
                    <ToggleButton
                        IsChecked="{Binding ShowUnderbar, Mode=TwoWay}"
                        Style="{StaticResource ToolbarToggleButton}"
                        ToolTip="{DynamicResource MainWindow_ShowHideUnderbar}">
                        <Image Source="/Images/GUI/underbar.png" Style="{StaticResource ToolbarImage}" />
                    </ToggleButton>
                    <!--<Separator />
                    <StackPanel
                        Height="30"
                        Margin="3 0 3 0"
                        Orientation="Horizontal">
                        <Label
                            Margin="0 0 3 0"
                            VerticalAlignment="Center"
                            Content="New Integral Italic" />
                        <CheckBox
                            Grid.Column="1"
                            Width="30"
                            Height="30"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            IsChecked="{Binding UseItalicIntergalOnNew, Mode=TwoWay}" />
                    </StackPanel>-->
                </ToolBar>
            </ToolBarTray>
        </Grid>
        <StackPanel
            DockPanel.Dock="Top"
            DockPanel.ZIndex="100"
            Orientation="Vertical">
            <local:CharacterToolBar
                x:Name="CharacterToolBar"
                Padding="0 4"
                Panel.ZIndex="100"
                ClipToBounds="False" />
            <local:EquationToolBar
                x:Name="EquationToolBar"
                Padding="0 6"
                Panel.ZIndex="99"
                ClipToBounds="False" />
            <local:HistoryToolBar
                x:Name="HistoryToolBar"
                BorderBrush="#FFB6B6B6"
                BorderThickness="0 0 0 1" />
        </StackPanel>
        <Grid DockPanel.Dock="Bottom">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Label
                Grid.Column="0"
                Height="25"
                HorizontalAlignment="Left"
                Content="{Binding StatusBarLeftMessage, Mode=OneWay}" />
            <Label
                Grid.Column="1"
                Height="25"
                HorizontalAlignment="Right"
                Content="{Binding StatusBarRightMessage, Mode=OneWay}" />
        </Grid>
        <ui:ScrollViewerEx
            x:Name="ScrollViewer"
            FocusVisualStyle="{x:Null}"
            Focusable="True"
            HorizontalScrollBarVisibility="Auto"
            ScrollChanged="ScrollViewer_ScrollChanged">
            <!--  We use codes to add EditorControl so that we can use Window reference in its constructor  -->
            <!--<local:EditorControl
                x:Name="Editor"
                Background="Transparent"
                FocusVisualStyle="{x:Null}"
                Focusable="True"
                Loaded="Editor_Loaded" />-->
        </ui:ScrollViewerEx>
    </DockPanel>
</Window>